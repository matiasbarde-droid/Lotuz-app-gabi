openapi: 3.0.3
info:
  title: Lotuz API
  version: 1.0.0
  description: API del backend de Lotuz para autenticación, catálogo, perfil, checkout y administración.
servers:
  - url: http://localhost:8080
    description: Servidor local de desarrollo
paths:
  /api/auth/register:
    post:
      tags:
        - Autenticación
      summary: Registrar nuevo usuario cliente
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Usuario'
      responses:
        '201':
          description: Usuario creado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Usuario'
        '400':
          description: Datos inválidos
  /api/auth/login:
    post:
      tags:
        - Autenticación
      summary: Iniciar sesión
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Inicio de sesión exitoso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Usuario'
        '401':
          description: No autorizado
  /api/productos:
    get:
      tags:
        - Productos
      summary: Listar productos públicos
      parameters:
        - name: terminoBusqueda
          in: query
          schema:
            type: string
        - name: categoria
          in: query
          schema:
            $ref: '#/components/schemas/Categoria'
        - name: orden
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Lista de productos
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Producto'
  /api/productos/{sku}:
    get:
      tags:
        - Productos
      summary: Obtener producto por SKU
      parameters:
        - name: sku
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Producto encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Producto'
        '404':
          description: No encontrado
  /api/admin/productos:
    post:
      tags:
        - Admin Productos
      summary: Crear producto
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Producto'
      responses:
        '201':
          description: Producto creado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Producto'
  /api/admin/productos/{sku}:
    put:
      tags:
        - Admin Productos
      summary: Actualizar producto por SKU
      parameters:
        - name: sku
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Producto'
      responses:
        '200':
          description: Producto actualizado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Producto'
    delete:
      tags:
        - Admin Productos
      summary: Eliminar producto por SKU
      parameters:
        - name: sku
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Eliminado
  /api/admin/usuarios:
    get:
      tags:
        - Admin Usuarios
      summary: Listar usuarios
      responses:
        '200':
          description: Lista de usuarios
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Usuario'
    post:
      tags:
        - Admin Usuarios
      summary: Crear usuario
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Usuario'
      responses:
        '201':
          description: Usuario creado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Usuario'
  /api/admin/usuarios/{id}:
    get:
      tags:
        - Admin Usuarios
      summary: Obtener usuario por ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Usuario encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Usuario'
    put:
      tags:
        - Admin Usuarios
      summary: Actualizar usuario
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Usuario'
      responses:
        '200':
          description: Usuario actualizado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Usuario'
    delete:
      tags:
        - Admin Usuarios
      summary: Eliminar usuario
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Eliminado
  /api/checkout:
    post:
      tags:
        - Checkout
      summary: Crear orden de compra
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CheckoutRequest'
      responses:
        '201':
          description: Orden creada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Orden'
  /api/perfil/{id}:
    get:
      tags:
        - Perfil
      summary: Obtener perfil de usuario
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Perfil
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Usuario'
    put:
      tags:
        - Perfil
      summary: Actualizar perfil de usuario
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Usuario'
      responses:
        '200':
          description: Perfil actualizado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Usuario'
  /api/perfil/{id}/ordenes:
    get:
      tags:
        - Perfil
      summary: Listar historial de compras del usuario
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Historial de órdenes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Orden'
  /api/admin/ordenes:
    get:
      tags:
        - Admin Órdenes
      summary: Listar órdenes
      parameters:
        - name: terminoBusqueda
          in: query
          schema:
            type: string
        - name: estadoFiltro
          in: query
          schema:
            $ref: '#/components/schemas/EstadoOrden'
      responses:
        '200':
          description: Lista de órdenes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Orden'
  /api/admin/ordenes/{id}:
    get:
      tags:
        - Admin Órdenes
      summary: Obtener orden por ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Orden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Orden'
    delete:
      tags:
        - Admin Órdenes
      summary: Eliminar orden
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Eliminado
  /api/admin/ordenes/{numeroOrden}/estado:
    put:
      tags:
        - Admin Órdenes
      summary: Actualizar estado de una orden por número
      parameters:
        - name: numeroOrden
          in: path
          required: true
          schema:
            type: string
        - name: nuevoEstado
          in: query
          required: true
          schema:
            $ref: '#/components/schemas/EstadoOrden'
      responses:
        '200':
          description: Orden actualizada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Orden'
components:
  schemas:
    LoginRequest:
      type: object
      properties:
        correo:
          type: string
          format: email
        password:
          type: string
      required:
        - correo
        - password
    Usuario:
      type: object
      properties:
        id:
          type: integer
          format: int64
        rol:
          $ref: '#/components/schemas/Roles'
        createdAt:
          type: string
          format: date-time
        correo:
          type: string
          format: email
        password:
          type: string
          writeOnly: true
        nombre:
          type: string
        rut:
          type: string
        telefono:
          type: string
        direccion:
          type: string
        pais:
          type: string
        region:
          type: string
        comuna:
          type: string
      required:
        - correo
        - password
    Producto:
      type: object
      properties:
        id:
          type: integer
          format: int64
        sku:
          type: string
        nombre:
          type: string
        precio:
          type: integer
          format: int64
        categoria:
          $ref: '#/components/schemas/Categoria'
        fotoUrl:
          type: string
        descripcion:
          type: string
      required:
        - sku
        - nombre
        - precio
        - categoria
    CarritoItem:
      type: object
      properties:
        id:
          type: integer
          format: int64
        sku:
          type: string
        cantidad:
          type: integer
          format: int64
      required:
        - sku
        - cantidad
    ItemOrden:
      type: object
      properties:
        id:
          type: integer
          format: int64
        productoSku:
          type: string
        nombreProducto:
          type: string
        precioUnitario:
          type: integer
          format: int64
        cantidad:
          type: integer
          format: int64
      required:
        - productoSku
        - nombreProducto
        - precioUnitario
        - cantidad
    Orden:
      type: object
      properties:
        id:
          type: integer
          format: int64
        numeroOrden:
          type: string
        emailCliente:
          type: string
          format: email
        usuarioId:
          type: integer
          format: int64
        modo:
          type: string
          description: 'user' o 'guest'
        fechaCreacion:
          type: string
          format: date-time
        total:
          type: integer
          format: int64
        estado:
          $ref: '#/components/schemas/EstadoOrden'
        pagoId:
          type: string
        codigoAutorizacion:
          type: string
        items:
          type: array
          items:
            $ref: '#/components/schemas/ItemOrden'
      required:
        - numeroOrden
        - emailCliente
        - total
        - estado
    Categoria:
      type: string
      enum:
        - MOUSEPAD
        - MOUSE
        - AUDIFONOS
        - TECLADO
    Roles:
      type: string
      enum:
        - CLIENTE
        - ADMIN
    EstadoOrden:
      type: string
      enum:
        - PAGADO
        - PREPARANDO
        - DESPACHADO
        - ENTREGADO
        - ANULADO
        - REEMBOLSADO
    CheckoutRequest:
      type: object
      properties:
        usuarioId:
          type: integer
          format: int64
        emailInvitado:
          type: string
          format: email
        items:
          type: array
          items:
            $ref: '#/components/schemas/CarritoItem'
      required:
        - items